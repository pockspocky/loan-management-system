# è´·æ¬¾ç®¡ç†ç³»ç»Ÿåç«¯å®ç°æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: è´·æ¬¾ç®¡ç†ç³»ç»Ÿ - åç«¯æœåŠ¡  
**æŠ€æœ¯æ ˆ**: Node.js + Express + MongoDB  
**ä»“åº“åœ°å€**: https://github.com/pockspocky/loan-management-backend.git  
**APIåŸŸå**: https://zlyoszudwbcc.sealoshzh.site  
**æ–‡æ¡£æ—¥æœŸ**: 2024å¹´12æœˆ18æ—¥  

## ğŸ”§ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **è¿è¡Œç¯å¢ƒ**: Node.js
- **Webæ¡†æ¶**: Express.js
- **æ•°æ®åº“**: MongoDB
- **è®¤è¯æ–¹å¼**: JWT (JSON Web Token)
- **æ•°æ®éªŒè¯**: Joi
- **æ–‡ä»¶ä¸Šä¼ **: Multer
- **æ—¥å¿—ç³»ç»Ÿ**: è‡ªå®šä¹‰æ—¥å¿—è®°å½•

### é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·
```
ç”¨æˆ·å: admin
å¯†ç : admin123456
é‚®ç®±: admin@example.com
```

## âœ… å·²å®ç°åŠŸèƒ½

### 1. ç”¨æˆ·è®¤è¯æ¨¡å—
- **ç™»å½•æ¥å£** (`POST /api/v1/auth/login`)
  - æ”¯æŒç”¨æˆ·å/é‚®ç®±ç™»å½•
  - JWT Tokenç”Ÿæˆ
  - åˆ·æ–°Tokenæœºåˆ¶
  
- **æ³¨å†Œæ¥å£** (`POST /api/v1/auth/register`)
  - ç”¨æˆ·åå¯†ç æ³¨å†Œ
  - å¿…å¡«å­—æ®µï¼š`username`, `password`
  - è‡ªåŠ¨è§’è‰²åˆ†é…
  - æ”¯æŒé‡å¤æ£€æŸ¥ï¼ˆç”¨æˆ·åï¼‰
  - **æ³¨æ„**ï¼šåç«¯éœ€è¦ç§»é™¤å¯¹ `real_name`, `phone`, `id_card` å­—æ®µçš„éªŒè¯è¦æ±‚
  
- **ç™»å‡ºæ¥å£** (`POST /api/v1/auth/logout`)
  - Tokenå¤±æ•ˆå¤„ç†

### 2. ç”¨æˆ·ç®¡ç†æ¨¡å—
- **ç”¨æˆ·åˆ—è¡¨** (`GET /api/v1/users`)
- **ç”¨æˆ·è¯¦æƒ…** (`GET /api/v1/users/profile`)
- **ç”¨æˆ·æ›´æ–°** (`PUT /api/v1/users/profile`)
- **ç”¨æˆ·åˆ é™¤** (`DELETE /api/v1/users/:id`)

### 3. è´·æ¬¾ç®¡ç†æ¨¡å—
- **è´·æ¬¾åˆ—è¡¨** (`GET /api/v1/loans`)
- **è´·æ¬¾è¯¦æƒ…** (`GET /api/v1/loans/:id`)
- **åˆ›å»ºè´·æ¬¾** (`POST /api/v1/loans`)
- **æ›´æ–°è´·æ¬¾** (`PUT /api/v1/loans/:id`)
- **è´·æ¬¾å®¡æ‰¹** (`PATCH /api/v1/loans/:id/approve`)
- **è´·æ¬¾æ‹’ç»** (`PATCH /api/v1/loans/:id/reject`)
- **è´·æ¬¾ç»Ÿè®¡** (`GET /api/v1/loans/statistics`)

### 4. è´·æ¬¾è®¡ç®—æ¨¡å—
- **åˆ©æ¯è®¡ç®—** (`POST /api/v1/loans/calculate`)
  - ç­‰é¢æœ¬æ¯è®¡ç®—
  - ç­‰é¢æœ¬é‡‘è®¡ç®—
  - å…ˆæ¯åæœ¬è®¡ç®—
  - ä¸€æ¬¡æ€§è¿˜æœ¬ä»˜æ¯è®¡ç®—

### 5. æ–‡ä»¶ä¸Šä¼ æ¨¡å—
- æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼
- æ–‡ä»¶å¤§å°é™åˆ¶
- æ–‡ä»¶å­˜å‚¨ç®¡ç†

## âš ï¸ å·²çŸ¥é—®é¢˜

### 1. ç”³è¯·äººå§“åè¦†ç›–é—®é¢˜
**é—®é¢˜æè¿°**: è´·æ¬¾ç”³è¯·æ—¶ï¼Œåç«¯è‡ªåŠ¨å°†ç”³è¯·äººå§“åè¦†ç›–ä¸ºå½“å‰ç™»å½•ç”¨æˆ·çš„å§“å  
**å½±å“**: æ— æ³•ä¸ºä»–äººä»£ç†ç”³è¯·è´·æ¬¾  
**ç´§æ€¥ç¨‹åº¦**: é«˜  
**å»ºè®®ä¿®å¤**: ä¿æŒå‰ç«¯å‘é€çš„ç”³è¯·äººå§“åä¸è¢«è¦†ç›–  

### 2. è¿˜æ¬¾è®¡åˆ’åŠŸèƒ½ç¼ºå¤±
**é—®é¢˜æè¿°**: è¿˜æ¬¾ç›¸å…³APIç«¯ç‚¹ç¼ºå¤±æˆ–ä¸å®Œæ•´  
**ç¼ºå¤±æ¥å£**:
- `POST /api/v1/loans/:loanId/payments` - è®°å½•è¿˜æ¬¾
- `GET /api/v1/loans/:loanId/repayment-schedule` - è·å–è¿˜æ¬¾è®¡åˆ’
- `GET /api/v1/loans/:loanId/payment-stats` - è¿˜æ¬¾ç»Ÿè®¡

**å½±å“**: å‰ç«¯è¿˜æ¬¾ç»Ÿè®¡åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œ  
**ç´§æ€¥ç¨‹åº¦**: é«˜  

### 3. æ³¨å†Œæ¥å£å­—æ®µç®€åŒ–éœ€æ±‚
**é—®é¢˜æè¿°**: å‰ç«¯å·²ç®€åŒ–æ³¨å†Œé¡µé¢ï¼Œåªéœ€è¦ç”¨æˆ·åå’Œå¯†ç å­—æ®µ  
**åç«¯éœ€è¦ä¿®æ”¹**: ç§»é™¤å¯¹ `real_name`, `phone`, `id_card` å­—æ®µçš„å¿…å¡«éªŒè¯  
**å½±å“**: å½“å‰åç«¯ä»è¦æ±‚è¿™äº›å­—æ®µï¼Œä¼šå¯¼è‡´æ³¨å†Œå¤±è´¥  
**ç´§æ€¥ç¨‹åº¦**: ä¸­  
**å»ºè®®ä¿®å¤**: ä¿®æ”¹åç«¯æ³¨å†ŒéªŒè¯é€»è¾‘ï¼ŒåªéªŒè¯ `username` å’Œ `password` å­—æ®µ

## ğŸ”„ éœ€è¦ä¿®å¤çš„åç«¯æ–‡ä»¶

### 1. è·¯ç”±æ–‡ä»¶ (`src/routes/loans.js`)
```javascript
// éœ€è¦æ·»åŠ çš„è·¯ç”±
router.post('/:loanId/payments', auth, loanController.addPayment);
router.get('/:loanId/repayment-schedule', auth, loanController.getRepaymentSchedule);
router.get('/:loanId/payment-stats', auth, loanController.getPaymentStats);
```

### 2. æ§åˆ¶å™¨æ–‡ä»¶ (`src/controllers/loanController.js`)
éœ€è¦æ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š
- `addPayment()` - å¤„ç†è¿˜æ¬¾è®°å½•
- `getRepaymentSchedule()` - ç”Ÿæˆè¿˜æ¬¾è®¡åˆ’
- `getPaymentStats()` - è®¡ç®—è¿˜æ¬¾ç»Ÿè®¡

### 3. æ•°æ®æ¨¡å‹æ–‡ä»¶
**æ–°å»º**: `src/models/RepaymentSchedule.js`
```javascript
// è¿˜æ¬¾è®¡åˆ’æ¨¡å‹
const repaymentScheduleSchema = new mongoose.Schema({
  loanId: { type: mongoose.Schema.Types.ObjectId, ref: 'Loan', required: true },
  installmentNumber: { type: Number, required: true },
  dueDate: { type: Date, required: true },
  principalAmount: { type: Number, required: true },
  interestAmount: { type: Number, required: true },
  totalAmount: { type: Number, required: true },
  status: { type: String, enum: ['pending', 'paid', 'overdue'], default: 'pending' }
});
```

**æ–°å»º**: `src/models/Payment.js`
```javascript
// è¿˜æ¬¾è®°å½•æ¨¡å‹
const paymentSchema = new mongoose.Schema({
  loanId: { type: mongoose.Schema.Types.ObjectId, ref: 'Loan', required: true },
  amount: { type: Number, required: true },
  paymentDate: { type: Date, default: Date.now },
  paymentMethod: { type: String, required: true },
  status: { type: String, enum: ['completed', 'pending', 'failed'], default: 'completed' }
});
```

### 4. å·¥å…·å‡½æ•°æ–‡ä»¶
**æ–°å»º**: `src/utils/repaymentCalculator.js`
```javascript
// è¿˜æ¬¾è®¡åˆ’ç”Ÿæˆå·¥å…·
function generateRepaymentSchedule(loan) {
  // æ ¹æ®è´·æ¬¾ä¿¡æ¯ç”Ÿæˆå®Œæ•´çš„è¿˜æ¬¾è®¡åˆ’
  // æ”¯æŒä¸åŒçš„è¿˜æ¬¾æ–¹å¼è®¡ç®—
}
```

## ğŸ“Š APIçŠ¶æ€æ±‡æ€»

| åŠŸèƒ½æ¨¡å— | æ¥å£æ•°é‡ | å®ŒæˆçŠ¶æ€ | å¤‡æ³¨ |
|---------|----------|----------|------|
| ç”¨æˆ·è®¤è¯ | 3 | âœ… å®Œæˆ | ç™»å½•/æ³¨å†Œ/ç™»å‡º |
| ç”¨æˆ·ç®¡ç† | 4 | âœ… å®Œæˆ | CRUDæ“ä½œ |
| è´·æ¬¾ç®¡ç† | 7 | âš ï¸ éƒ¨åˆ†å®Œæˆ | ç¼ºå°‘è¿˜æ¬¾ç›¸å…³æ¥å£ |
| è´·æ¬¾è®¡ç®— | 1 | âœ… å®Œæˆ | åˆ©æ¯è®¡ç®— |
| æ–‡ä»¶ä¸Šä¼  | 1 | âœ… å®Œæˆ | æ–‡ä»¶ç®¡ç† |
| è¿˜æ¬¾ç®¡ç† | 0/3 | âŒ æœªå®ç° | éœ€è¦æ–°å¢ |

## ğŸ¯ ä¼˜å…ˆä¿®å¤å»ºè®®

### é«˜ä¼˜å…ˆçº§ (P0)
1. **ä¿®å¤ç”³è¯·äººå§“åè¦†ç›–é—®é¢˜**
   - æ–‡ä»¶: `src/controllers/loanController.js`
   - é¢„è®¡å·¥ä½œé‡: 1-2å°æ—¶

2. **å®ç°è¿˜æ¬¾ç®¡ç†åŠŸèƒ½**
   - æ–°å¢3ä¸ªAPIæ¥å£
   - æ–°å¢2ä¸ªæ•°æ®æ¨¡å‹
   - æ–°å¢è®¡ç®—å·¥å…·å‡½æ•°
   - é¢„è®¡å·¥ä½œé‡: 1-2å¤©

### ä¸­ä¼˜å…ˆçº§ (P1)
1. **å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶**
2. **æ·»åŠ APIæ–‡æ¡£ï¼ˆSwaggerï¼‰**
3. **å¢å¼ºæ•°æ®éªŒè¯è§„åˆ™**

### ä½ä¼˜å…ˆçº§ (P2)
1. **æ€§èƒ½ä¼˜åŒ–**
2. **æ—¥å¿—å®Œå–„**
3. **æµ‹è¯•ç”¨ä¾‹è¡¥å……**

## ğŸ¯ æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
- [ ] ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼ˆä»…åŒ…å«ç”¨æˆ·åã€å¯†ç å­—æ®µï¼‰
- [ ] è´·æ¬¾ç”³è¯·æµç¨‹ï¼ˆç”³è¯·äººå§“åä¿æŒï¼‰
- [ ] è¿˜æ¬¾åŠŸèƒ½å®Œæ•´æµç¨‹
- [ ] æ•°æ®è®¡ç®—ç²¾åº¦éªŒè¯
- [ ] æ³¨å†Œæ•°æ®é‡å¤æ£€æŸ¥ï¼ˆç”¨æˆ·åï¼‰

### æ¥å£æµ‹è¯•
- [ ] æ‰€æœ‰APIç«¯ç‚¹å¯è®¿é—®æ€§æµ‹è¯•
- [ ] è®¤è¯æˆæƒæµ‹è¯•
- [ ] é”™è¯¯å¤„ç†æµ‹è¯•
- [ ] æ•°æ®æ ¼å¼éªŒè¯æµ‹è¯•

## ğŸ“ˆ åç»­å‘å±•å»ºè®®

1. **å¾®æœåŠ¡æ¶æ„æ¼”è¿›**
   - æ‹†åˆ†è®¤è¯æœåŠ¡
   - æ‹†åˆ†è®¡ç®—æœåŠ¡
   - æ‹†åˆ†æ–‡ä»¶æœåŠ¡

2. **æ•°æ®åº“ä¼˜åŒ–**
   - æ·»åŠ ç´¢å¼•ä¼˜åŒ–
   - åˆ†åº“åˆ†è¡¨è§„åˆ’
   - ç¼“å­˜ç­–ç•¥å®æ–½

3. **å®‰å…¨å¢å¼º**
   - APIé™æµæœºåˆ¶
   - æ•°æ®åŠ å¯†
   - å®¡è®¡æ—¥å¿—

## ğŸ“ è”ç³»ä¿¡æ¯

**æŠ¥å‘Šç¼–å†™**: AIåŠ©æ‰‹  
**å®¡æ ¸å»ºè®®**: å‰ç«¯å¼€å‘å›¢é˜Ÿ  
**æ›´æ–°é¢‘ç‡**: æ¯å‘¨æ›´æ–°ä¸€æ¬¡  

---

**æ³¨æ„**: æœ¬æŠ¥å‘ŠåŸºäºå½“å‰å·²çŸ¥ä¿¡æ¯ç¼–å†™ï¼Œå®é™…åç«¯å®ç°å¯èƒ½å­˜åœ¨å·®å¼‚ã€‚å»ºè®®åœ¨ä¿®å¤å‰å…ˆä¸åç«¯å¼€å‘å›¢é˜Ÿç¡®è®¤å…·ä½“å®ç°ç»†èŠ‚ã€‚ 